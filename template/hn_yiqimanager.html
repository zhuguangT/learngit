<!-- 计量仪器设备一览表 -->
<script type="text/javascript" src="$rooturl/js/jquery.PrintArea.js"></script>
<style>
.tablelv { border:1px #0CF solid; border-collapse:collapse; width:1250px;margin:auto}
.tablelv *{ color:#363636}
.tablelv tr td{ font-size:12px; height:20px; line-height:20px; border:1px solid #00CCFF;align:center;}
a{text-decoration:none}
a:hover{color:red}
input{background:#AACCFF}
select{background:#AACCFF}
</style>
<script>
function returns(){
     gotourl('hn_yiqimanager.php?page=1');
}

function tiao(){
     gotourl('yiqi_save.php');
}
$(document).ready(function() {
	
	// xuid = 'xu'+(($beginpage/$pagesize)+1);
	
	// var xu = document.getElementById(xuid);
	// if(xu!=null)//查询为空时会这句影响这句出错
	// xu.style.color=000;
	//分页  不需要这个jquery
	// document.getElementById('btngo').onclick=function(){
	// 		page = document.getElementById('txtgo').value;
	// 		if(page == 0)
	// 			return;
	// 		var name = zhuru($('#yq_name_list').val());
	// 		var ren = zhuru($('#yq_ren_list').val());
	// 		var state = zhuru($('#yq_state').val());
	// 		var xinghao = zhuru($('#yq_xinghao_list').val());
	// 		if(page <= $total_page)
	// 			location.href = "hn_yiqimanager.php?page="+page+"&name="+name+"&ren="+ren+"&state="+state+"&xinghao"+xinghao;
	// }
	
	cls('yq_name_list');
	cls('yq_ren_list');
	function cls(id){
		document.getElementById(id).onfocus=function(){
			document.getElementById(id).value='';
		}
	}
	changes2('yq_state');
	changes('cx');
	$("#yq_name_list").change(function(){
			var name = zhuru($('#yq_name_list').val());
			var ren = zhuru($('#yq_ren_list').val());
			var state = zhuru($('#yq_state').val());
			var xinghao = zhuru($('#yq_xinghao_list').val());
		var guanlibm = zhuru($('#yq_guanlibm_list').val());
			var str = this.value;
		   gotourl('hn_yiqimanager.php?name='+name+"&ren="+ren+"&state="+state+"&guanlibm="+guanlibm);
	});
	$("#yq_xinghao_list").change(function(){
		var name = zhuru($('#yq_name_list').val());
		var ren = zhuru($('#yq_ren_list').val());
		var state = zhuru($('#yq_state').val());
		var xinghao = zhuru($('#yq_xinghao_list').val());
		var guanlibm = zhuru($('#yq_guanlibm_list').val());
		var str = this.value;
	   gotourl('hn_yiqimanager.php?ren='+ren+"&state="+state+"&xinghao="+xinghao+"&guanlibm="+guanlibm);
	});
	$("#yq_guanlibm_list").change(function(){
		var name = zhuru($('#yq_name_list').val());
		var ren = zhuru($('#yq_ren_list').val());
		var state = zhuru($('#yq_state').val());
		var xinghao = zhuru($('#yq_xinghao_list').val());
		var guanlibm = zhuru($('#yq_guanlibm_list').val());
		var str = this.value;
	   gotourl('hn_yiqimanager.php?ren='+ren+"&state="+state+"&xinghao="+xinghao+"&guanlibm="+guanlibm);
	});
	function changes(id){
		$('#'+id).click(function() {
			var xinghao = zhuru($('#yq_xinghao_list').val());
			var name = zhuru($('#yq_name_list').val());
			var ren = zhuru($('#yq_ren_list').val());
			var state = zhuru($('#yq_state').val());
		var guanlibm = zhuru($('#yq_guanlibm_list').val());
			var str = this.value;
		   gotourl('hn_yiqimanager.php?yq_type='+type+"&name="+name+"&ren="+ren+"&state="+state+"&guanlibm="+guanlibm);
		});
	}
		function changes2(id){
		$('#'+id).change(function() {
			// var type = zhuru($('#yqtypelist').val());
			var name = zhuru($('#yq_name_list').val());
			var ren = zhuru($('#yq_ren_list').val());
			var state = zhuru($('#yq_state').val());
			var xinghao = zhuru($('#yq_xinghao_list').val());
		var guanlibm = zhuru($('#yq_guanlibm_list').val());
			var str = this.value;
		   gotourl('hn_yiqimanager.php?page=1&xinghao='+xinghao+"&name="+name+"&ren="+ren+"&state="+state+"&guanlibm="+guanlibm);
		});
	}
	function zhuru(str){
		str= str.replace(/'/g,"‘");
		str= str.replace(/"/g,"“");
		return str.replace(/;/g,"；"); 
	}
	$('#jrjdzt').click(function(){
		var type = zhuru($('#yqtypelist').val());
		var name = zhuru($('#yq_name_list').val());
		var ren = zhuru($('#yq_ren_list').val());
		var state = zhuru($('#yq_state').val());
		gotourl('jrjd.php?page=1&yq_type='+type+"&name="+name+"&ren="+ren+"&state="+state+"&jrjd=yes");
	
	});	
});    
$(document).ready(function() {
	$(".chosen-select").chosen();
	load_height();	
});
//查询近检设备
	function find_jj(){
		var type = $('#yqtypelist').val();
		gotourl('jrjd.php?page=1&yq_type='+type+"&handle=find_jj");
	}    
//查询当前页的 #tabs
$(window).ready(function(){
	var tabs = $('.ui-tabs-active').find('a').attr('href');
	var next_page_href = $(".next_page").find('a').attr('href');
	var prev_page_href = $(".prev_page").find('a').attr('href');
	var num_page_href = $(".xu").attr('href');
	if(next_page_href){
		$(".next_page").find('a').attr('href',next_page_href+tabs);
	}
	if(prev_page_href){
		$(".prev_page").find('a').attr('href',prev_page_href+tabs);
	}
	if(num_page_href){
		$(".xu").attr('href',num_page_href+tabs);
	}
});
//批量修改类别
function up_lbb(obj){
	var val = $(obj).val();
	if(val == '修改类别'){
		$(obj).val('取消修改类别');
		$(".label_li").each(function(){
			var type_val = $(this).children('a').text();
			if(type_val != '全部'){
				$(this).children('span').show();
			}
		});
	}else{
		$(obj).val('修改类别');
		$(".label_li").each(function(){
			var type_val = $(this).children('a').text();
			if(type_val != '全部'){
				$(this).children('span').hide();
			}
		});
	}
}
function up_type(obj){
	var val = $(obj).prev().text();
	var up_val = prompt("修改类型名称" , val);
	if(up_val != null && up_val != ''){
		$.post("hn_yiqimanager.php" , {"handle" : 'up_type_ajax' , 'old_type' : val , "new_type" : up_val} , function(data){
			if(data == 'ok'){
				alert("修改成功");
				$(obj).prev().text(up_val);
			}else{
				alert('修改失败');
			}
		});
	}else{
		alert("格式不正确，修改失败");
	}
}
</script>

<div style="width:100%;margin:0 auto;">
	<h3 class="header smaller center title" >设备一览表</h3>
  <div id="tabs" style="width:100%;margin:0 auto;padding:0;" class="center" >
  <ul>
	$label   
  </ul>
  </div>
</div>

<form name="form2" action="" class="tablev" method="post" >
<div class="widget-box no-border center my_area">
	<div class="widget-header header-color-blue4 center" style="position:relative;">
	  <div class="widget-toolbar">
	  <nav style="position: absolute;left:0;top:-10px;"><ul class="pagination pagination-sm">$prepage$nextpage</ul></nav>
           <center>
           <tr>
				仪器名称：<select id="yq_name_list" class="chosen-select" name="yq_mingcheng" value="" style="width:200px"><option selected>全部</option>$selected_name$name_str</select>
				仪器型号：<select id="yq_xinghao_list" class="chosen-select" name="yq_xinghao_list" value="" style="width:200px"><option selected>全部</option>$selected_xinghao$xinghao_str</select>
				管理部门：<select id="yq_guanlibm_list" class="chosen-select" name="yq_guanlibm_list" value="" style="width:200px"><option selected>全部</option>$selected_guanlibm$guanlibm_str</select>
				<!--下边的td span 保留 !important-->
				<td ><span style="display:none">保管人：<input type="text" name="yq_ren_list" id ="yq_ren_list" value="$ren"  list="yq_baoguanren"  size="8"/></span></td>
               <td>仪器状态：<select name="yq_state" id = "yq_state" class="chosen-select"  style="width:100px" value="$state"> 
              <!-- <tr>
			  <label style="cursor:pointer;" for="select">请选择仪器类别:</label>
			  <input type ="text" list="yq_type" id="yqtypelist" value = "$type" size="10">
			  <datalist name='yq_type' id='yq_type' >
				$type_str
				</datalist>
               <td>仪器名称:<input type="text"  name="yq_mingcheng" id="yq_name_list" value = "$name" list="yq_mingcheng" size="10"/></td>
					<datalist id="yq_mingcheng">
					$name_str
					</datalist>
				 <td>保管人：<input type="text" name="yq_ren_list" id ="yq_ren_list" value="$ren"  list="yq_baoguanren"  size="8"/></td>
               <datalist id="yq_baoguanren">
               $ren_str
               </datalist>
               <td>仪器状态：<select name="yq_state" id = "yq_state" value="$state">  -->
            $statetiao()
            $selected_status
                </select></td>
              
         <span class='submit_hide'>      
		  <td ><input class="btn btn-xs btn-primary" type="button" value="查询" id="cx"></td>
       <td ><input class="btn btn-xs btn-primary" type="button" value="新增" id="new" onclick="tiao()"></td>
		<td ><input class="btn btn-xs btn-primary" type="button" value="返回" onclick="returns()"></td>
		<td><input class="btn btn-xs btn-primary" type= 'button' value='本月进入检定状态' id = 'jrjdzt' onclick="find_jj();"></td>
		<td><input class="btn btn-xs btn-primary" type= 'button' value='打印台帐' id = 'dytz' onclick="gt()"></td>
		<td><input class="btn btn-xs btn-primary" type= 'button' value='修改类别' id = 'up_lb' onclick="up_lbb(this);"></td>
		<td><input class="btn btn-xs btn-primary" type= 'button' value='下载列表页' id = 'dytz' onclick="download('$_GET[yq_type]')"></td>  
		$submit_jj  
		</span>
               </tr>
           </center>
	  </div>
	</div>
         <table><tr><td></td></tr></table>
	<table  class="table table-striped table-bordered table-hover center my_area"  bgcolor="Green">
		<thead>
			<tr align=center >
    				<th>序号</th>
    				<th>仪器名称</th>
    				<th>设备编号</th>
    				<th>型号</th>
    				$type_label
    				<th>设备原值（元）</th>
    				<th>财务资产编号</th>
    				<th>出厂编号</th>
    				<th>制造厂家</th>
    				<th>状态</th>
    				<th>购置日期</th>
    				<th>使用年限</th>
    				<th>下次检定日期</th>
    				<th>管理部门</th>
    				<th>设备存放地点</th>
    				<th>档案位置</th>
    				<th colspan=2>操作</th>
  			</tr>
 		</thead>
   		$lines
	</table>
	<!-- <a href = "hn_yiqimanager.php?beginpage=-1&yq_type=$_GET[yq_type]&name=$_GET[name]&ren=$_GET[ren]&state=$_GET[state]">上一页</a> $str |<a href = "hn_yiqimanager.php?beginpage=1&yq_type=$_GET[yq_type]&name=$_GET[name]&ren=$_GET[ren]&state=$_GET[state]">下一页</a><input type="text"  id="txtgo" size=2 ><input type="button" value="go" id="btngo" > -->
	<nav> 
	    <ul class="pagination">
	$prepage $str $nextpage
	<!-- $go -->
		</ul>
	</nav>
</div>
</form >
<!-- 弹出层 -->
		<div id="cover" class="modal" role="dialog" style='background-color:rgba(15, 15, 15, 0.7)!important;'>
			<div class="modal-dialog" style='width:800px;'>
				<div id="con" class='modal-content' style='width:800px;'>
					<form id='can' name='cansu' action='./taizhang.php' method='post' target="_blank">
						<center><h3>请选择需要打印的参数</h3></center>
						<table class='table table-bordered table-hover center' style='width:700px;'>
							<tr>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_mingcheng' value='仪器名称' checked>仪器名称</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_xinghao' value='型号及规格' checked>型号及规格</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_status' value='仪器状态' >仪器状态</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_chucangbh' value='出厂编号' checked>出厂编号</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_sbbianhao' value='资产编号' >资产编号</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_zzcangjia' value='制造厂家' checked>制造厂家</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_gouzhirq' value='购置日期' checked>购置日期</label></td>

							</tr>
							<tr>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_sbdidian' value='安置地点' checked>安置地点</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_jiage' value='设备原值' checked>设备原值</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_xianzhi' value='设备现值'>设备现值</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_wanhao' value='完好率'>完好率</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_daima' value='国家代码' >国家代码</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_zhunquedu' value='准确度等级' >准确度等级</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_celiang' value='测量范围' >测量范围</label></td>
							</tr>
							<tr>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_quanshudw' value='权属单位'>权属单位</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_guanlibm' value='管理部门'>管理部门</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_shiyongbm' value='使用部门'>使用部门</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_baoguanren' value='负责人'>负责人</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_jiandingriqi' value='检定日期'>检定日期</label></td>
								<td><label style="cursor:pointer;"><input type='checkbox' name='yq_beizhu' value='备注' checked>备注</label></td>
							</tr>
						</table>
						<center><input type='submit' class="btn btn-xs btn-primary" value='确定' onclick='guanbi()'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="btn btn-xs btn-primary" value="关闭" onclick="close_zz();"></center>
						<br/>
					</form>
				</div>
			</div>
		</div>
<!-- 弹出层 -->

<script>
function gt(){
	$('body').css("overflow","hidden")
	$("#cover").show();
}

function guanbi(){
	$('body').css("overflow","auto")
	$("#cover").hide();
}
//点击“关闭”关闭遮罩层
function close_zz(){
	$("#cover").hide();
}
</script>
<script type="text/javascript">
  $( "#tabs" ).tabs();
$(document).ready(function() {
  $(".chosen-select").chosen();
  load_height();  
});
</script>
<script type="text/javascript">
	$(function(){
		$(".chosen-select").chosen();
	});
	function get_url(){
		var url = 'name='+bzwz_list.wz_name.value+'&type=$_GET[type]';
		return url;
	}
	//下载
function download(yq_type){
	window.location.href="hn_yiqimanager.php?down=download&yq_type="+yq_type;
}
$(function(){ 
    $("#print_btn").click(function(){ 
    	$(".submit_hide").hide();
        $(".my_area").printArea();
        $(".submit_hide").show(); 
    }); 
}); 

</script>