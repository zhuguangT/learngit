<!-- 气相色谱 -->
<h1>气相色谱法检测{$arow['assay_element']}原始记录</h1>
{$hjtj_bt}
<table class="single" >
   <tr class="noborder">
    <td style="width:11%"></td><td style="width:12%"></td><td style="width:11%"></td><td style="width:11%"></td>
    <td style="width:11%"></td><td style="width:11%"></td><td style="width:11%"></td><td style="width:11%"></td>
    <td style="width:11%"></td>
  </tr>
  <tr align="center">
    <td colspan="1">检验项目</td>
    <td colspan="3">{$arow['assay_element']}</td>
    <td colspan="1">检验地点</td>
    <td colspan="4"><input type="text" name="td7" class="inputc" value="{$arow['td7']}" /></td>
  </tr>
  <tr>
    <td colspan="1">检验方法</td>
    <td colspan="3">{$arow['td1']}</td>
    <td colspan="1">方法依据</td>
    <td colspan="4">{$arow['td2']}</td>
  </tr>
  <tr>
    <td colspan="1">仪器型号</td>
    <td colspan="3">{$arow['td5']}</td>
    <td colspan="1">仪器编号</td>
    <td colspan="4">{$arow['yq_bh']}</td>
  </tr>
  <tr>
    <td colspan="9">仪器条件</td>
  </tr>
  <tr>
    <td colspan="1">检测器</td>
    <td colspan="1"><input type="text" name="td8" class="inputc" value="{$arow['td8']}" /></td>
    <td colspan="1">色谱柱</td>
    <td colspan="1"><input type="text" name="td9" class="inputc" value="{$arow['td9']}" /></td>
    <td colspan="1">进样口温度（℃）</td>
    <td colspan="1"><input type="text" name="td10" class="inputc" value="{$arow['td10']}" /></td>
    <td colspan="1">检测器温度（℃）</td>
    <td colspan="2"><input type="text" name="td11" class="inputc" value="{$arow['td11']}" /></td>
  </tr>
  <tr>
    <td colspan="1">柱箱温度（℃）</td>
    <td colspan="4"><input type="text" name="td12" class="inputc" value="{$arow['td12']}" /></td>
    <td colspan="1">柱流量（℃）</td>
    <td colspan="3"><input type="text" name="td13" class="inputc" value="{$arow['td13']}" /></td>
  </tr>
  <tr>
    <td colspan="2">计算公式</td>
    <td colspan="7">C（mg/L）=(C× V<sub>2</sub>）)/V<sub>1</sub></td>
  </tr>
  <tr class="bt_hidden">
    <td>检出限设置</td>
    <td>α-666</td>
    <td><input type="text" class="inputc" name="td10" value="${arow['td10']}" placeholder="0.0001" /></td>
    <td>β-666</td>
    <td><input type="text" class="inputc" name="td24" value="${arow['td24']}" placeholder="0.0001" /></td>
    <td>γ-666</td>
    <td><input type="text" class="inputc" name="td25" value="${arow['td25']}" placeholder="0.0001" /></td>
    <td>δ-666</td>
    <td><input type="text" class="inputc" name="td26" value="${arow['td26']}" placeholder="0.0001" /></td>
  </tr>
  <tr>
    <td>序号</td>
    <td>{$zhanming}</td>
    <td>α-666</td>
    <td>β-666</td>
    <td>γ-666</td>
    <td>δ-666</td>
    <td>{$arow['assay_element']}({$arow['unit']})</td>
    <td nowrap="nowrap">平均值<br />（{$arow['unit']}）</td>
    <td nowrap="nowrap">质控结果<br />（％）</td>
  </tr>
  {$aline}
  <tr>
    <td>备注</td>
    <td colspan="8"><textarea name="td30">{$arow['td30']}</textarea></td>
  </tr>
</table>
<input type="hidden" name="round_columns[]" value="vd3" />
<input type="hidden" name="round_columns[]" value="vd5" />
<input type="hidden" name="round_columns[]" value="vd7" />
<input type="hidden" name="round_columns[]" value="vd9" />
<script type="text/javascript">
//检出限默认
var jcx_628 = parseFloat('{$arow['td10']}');//α-666 628
var jcx_631 = parseFloat('{$arow['td24']}');//β-666 631
var jcx_219 = parseFloat('{$arow['td29']}');//γ-666 219
var jcx_637 = parseFloat('{$arow['td26']}');//δ-666 637

var unit_change_k = ('{$arow['unit']}'=='μg/L') ? 1000 : 1;
$.isNumeric(jcx_628) || (jcx_628=0.0001*unit_change_k);
$.isNumeric(jcx_631) || (jcx_631=0.0001*unit_change_k);
$.isNumeric(jcx_219) || (jcx_219=0.0001*unit_change_k);
$.isNumeric(jcx_637) || (jcx_637=0.0001*unit_change_k);
$(document).ready(function(){
  //第一次载入的时候
  $("#assay_form_{$tid} .hyd[value='']").trigger('blur');
})
window.jsgs = function() {
  var fl_arr = [628,631,219,637];
  try{
    if(''==vs['vd27']){
      var zl_obj = {};
    }else{
      var zl_obj = $.parseJSON(vs['vd27']);//总量
    }
  }catch(e){
    vs['vd0'] = '';
    return false;
  }
  var i = 3;      //存储数值的vd
  var jg = 0;     //结果值
  var zl_arr = {};//重定义分量的json数据
  var isNumeric = true;
  var xy_jcx_All = true;
  for( var k=0; k<fl_arr.length;k++){
    var vid = fl_arr[k];
    if(undefined == zl_obj[vid]){
      zl_obj[vid] = '';
    }
    //初始化存储分量结果的变量
    eval("var e_"+vid+" = '';");
    var e_628='';
    var e_631='';
    var e_219='';
    var e_637='';
    //输入的数据为数值格式
    var a = eval("$.isNumeric(vs['vd"+i+"'])");
    //输入的数据不是小于检出限的形式
    var b = eval("'<'!=parseFloat(vs['vd"+i+"'])");
    //载入的原始数据与记录的原始数据一致时说明并没有重新进行数据载入操作
    var c = eval("!$.isNumeric(vs['vd"+(i+1)+"']) || parseFloat(vs['vd"+(i+1)+"'])==parseFloat(zl_obj["+vid+"])");
    if( a && b && c ){
      //符合条件则说明是化验员在化验单上对数据手动做了修改
      eval("zl_obj["+vid+"]=vs['vd"+i+"']");
    }
    //重定义分量的json数据
    zl_arr[vid] = parseFloat(zl_obj[vid]);
    if(!$.isNumeric(zl_obj[vid])){
      //如果分量不是数值则清空数据
      eval("e_"+vid+" = vs['vd"+i+"'] = vs['vd"+(i+1)+"'] = '';");
    }else{
      //将分量计算值，显示值，原始值分别进行存储
      var nsbs = $.isNumeric($('.nsbs_{$tid}').val()) ? $('.nsbs_{$tid}').val() : 1;
      eval("e_"+vid+" = vs['vd"+i+"'] = vs['vd"+(i+1)+"'] = parseFloat(zl_obj["+vid+"])/nsbs;");
      //小于检出限的使用检出限的一半
      eval("if(e_"+vid+"<jcx_"+vid+"){e_"+vid+"=jcx_"+vid+"/2;vs['vd"+i+"'] = '<'+jcx_"+vid+";}else{xy_jcx_All=false;}");
    }
    i += 2;
    if(isNumeric && eval("$.isNumeric(e_"+vid+")")){
      //总量等于分量求和
      eval("jg += parseFloat(e_"+vid+");");
    }else{
      //如果有一个分量的数值没有则不再进行计算
      isNumeric = false;
    }
  }
  //重定义分量的json数据
  vs['vd27'] = JSON.stringify(zl_arr);
  if(isNumeric && $.isNumeric($(".nsbs_{$tid}").val())){
    vs['vd0'] = (xy_jcx_All==true) ? '<{$arow['td3']}' : jsws(jg);
  }else{
    vs['vd0'] = '';
  }
}
</script>